d= key.aggregate([{"$match":{"$text":{"$search":text},"file":{"$in":result}}},{"$unwind":"$original"},{"$match":{"original.ktype":"body"}},{"$sort":{"original.order":1}},{"$group":{"_id":"$file","file":{"$first":"$file"},"keys":{"$push":"$original"}}},{"$project":{"_id":0,"file":1,"keys":{"$slice":["$keys",3]}}},{"$unwind":"$keys"}, {"$lookup":{"from":"home_keyextract","let":{"site":"$file","ord":"$keys"},"pipeline":[ {"$match":{"$expr":{"$eq":["$file","$$site"]}}},{"$unwind":"$original"},{"$match":{"original.ktype":"body","$expr":{"$and":[{"$gt":["$original.order",{"$sum":["$$ord.order",-25]}]},{"$lt":["$original.order",{"$sum":["$$ord.order",25]}]}]}}},{"$sort":{"original.order":1}},{"$group":{"_id":"$file","content":{"$push":"$original.original"}}},{"$project":{"_id":0,"value":"$content"}}],"as":"content"}}])